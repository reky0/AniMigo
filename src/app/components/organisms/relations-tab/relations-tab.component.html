<ion-grid class="main ion-padding">
  @if (data &&
    ((data.relations && data.relations.edges && data.relations.edges.length > 0) ||
    (data.recommendations && data.recommendations.nodes && data.recommendations.nodes.length > 0))
  ) {
    @if (data.relations && data.relations.edges && data.relations.edges.length > 0) {
      <ion-row>
        <ion-col>
          <ion-row>
            <ion-col>
              <am-section-title title="Related" />
            </ion-col>
          </ion-row>
          @if (data) {
            <am-collapsible [thresholdHeight]="300">
              <ion-row>
                @for (related of data.relations.edges; track $index) {
                  <ion-col size="4" sizeLg="2">
                    <am-catalog-item
                      [image]="related.node.coverImage?.large?.replace('medium', 'large') ?? related.node.coverImage?.medium"
                      [fallbackImage]="related.node.coverImage?.large"
                      [title]="related.node.title.english ?? related.node.title.romaji"
                      [note]="toSentenceCase(related.relationType)"
                      [isFavourite]="related.node.isFavourite"
                      (click)="goToDetails(related.node.id, related.node.type, related.node.isAdult)"
                      />
                  </ion-col>
                }
              </ion-row>
            </am-collapsible>
          } @else {
            <ion-row>
              @for (i of 7 | range; track i) {
                <ion-col size="4" sizeLg="2">
                  <!--  -->
                </ion-col>
              }
            </ion-row>
          }
        </ion-col>
      </ion-row>
    }
    @if (data.recommendations && data.recommendations.nodes && data.recommendations.nodes.length > 0) {
      <ion-row>
        <ion-col>
          <ion-row>
            <ion-col>
              <am-section-title title="Recommendations" />
            </ion-col>
          </ion-row>
          @if (data) {
            <am-collapsible [thresholdHeight]="300">
              <ion-row>
                @for (recommendation of data.recommendations.nodes; track $index) {
                  <ion-col size="4" sizeLg="2">
                    <am-catalog-item
                      [image]="recommendation.mediaRecommendation.coverImage?.large ?? recommendation.mediaRecommendation.coverImage?.medium"
                      [title]="recommendation.mediaRecommendation.title.english ?? recommendation.mediaRecommendation.title.romaji"
                      [rating]="recommendation.rating"
                      recommendation="true"
                      [isFavourite]="recommendation.mediaRecommendation.isFavourite"
                      (click)="goToDetails(recommendation.mediaRecommendation.id, recommendation.mediaRecommendation.type, recommendation.mediaRecommendation.isAdult)"
                      />
                  </ion-col>
                }
              </ion-row>
            </am-collapsible>
          } @else {
            <ion-row>
              @for (i of 7 | range; track i) {
                <ion-col size="4" sizeLg="2">
                  <!--  -->
                </ion-col>
              }
            </ion-row>
          }
        </ion-col>
      </ion-row>
    }
  } @else {
    <ion-title>No relations available</ion-title>
  }
</ion-grid>

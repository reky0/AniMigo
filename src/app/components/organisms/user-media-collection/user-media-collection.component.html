@if (!isAuthenticated) {
  <am-login-prompt
    title="Login Required"
    [message]="'Please log in to view your ' + mediaType.toLowerCase() + ' list.'"
    [showImage]="true"
    (loginClick)="goToLogin()">
  </am-login-prompt>
} @else {
  <!-- Status Filter Segment -->
  <ion-segment
    [value]="selectedStatus"
    (ionChange)="onStatusChange($event)"
    scrollable="true"
    mode="md"
    class="status-segment">
    @for (status of statusOptions; track status.value) {
      <ion-segment-button [value]="status.value">
        <ion-label>{{ status.label }}</ion-label>
      </ion-segment-button>
    }
  </ion-segment>

  <!-- Pull to Refresh -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content
      refreshingSpinner="circles"
    />
  </ion-refresher>

  <!-- Loading State with Skeleton -->
  @if (loading && !hasDataInCache) {
    <ion-grid class="media-grid">
      <ion-row>
        @for (i of 30 | range; track $index) {
          <ion-col size="12" sizeMd="6" sizeLg="3">
            <am-media-list-item [loading]="true"></am-media-list-item>
          </ion-col>
        }
      </ion-row>
    </ion-grid>
  }

  <!-- Empty State -->
  @if (!loading && mediaList.length === 0) {
    <div class="empty-state">
      <ion-text color="medium">
        <h3>{{ emptyStateTitle }}</h3>
        <p>{{ emptyStateMessage }}</p>
      </ion-text>
    </div>
  }

  <!-- Media Grid -->
  @if (!loading && mediaList.length > 0) {
    <ion-grid class="media-grid">
      <ion-row>
        @for (entry of mediaList; track entry.id) {
          <ion-col size="12" sizeMd="6" sizeLg="3" (click)="goToDetails(entry)">
            <am-media-list-item
              [media]="entry.media"
              [isFavourite]="entry.media.isFavourite">
            </am-media-list-item>
          </ion-col>
        }
      </ion-row>
    </ion-grid>

    <!-- Infinite Scroll -->
    <ion-infinite-scroll
      threshold="100px"
      (ionInfinite)="onIonInfinite($event)"
      [disabled]="!hasMoreItems">
      <ion-infinite-scroll-content
        loadingSpinner="crescent"
        loadingText="Loading more...">
      </ion-infinite-scroll-content>
    </ion-infinite-scroll>
  }
}

<ion-grid class="main ion-activatable"
  [class.has-adult-badge]="isAdult"
  [title]="title"
  [class.hovered]="isHovered"
  (mouseenter)="onMouseEnter()"
  (mouseleave)="onMouseLeave()">
  <ion-ripple-effect></ion-ripple-effect>
  @if (loading) {
    <ion-row class="img-container">
      <ion-col>
        <div class="image-wrapper">
          <ion-skeleton-text [animated]="true" class="skeleton-image"></ion-skeleton-text>
        </div>
      </ion-col>
    </ion-row>
    <ion-row class="label-container">
      <ion-col>
        <ion-skeleton-text [animated]="true" class="skeleton-label-line1"></ion-skeleton-text>
      </ion-col>
    </ion-row>
    <ion-row class="rating bottom-row">
      <ion-col>
        <ion-skeleton-text [animated]="true" class="skeleton-rating"></ion-skeleton-text>
      </ion-col>
    </ion-row>
  } @else {
    <ion-row class="img-container pos-relative">
      <ion-col>
        <div class="image-wrapper">
          @if (!imageLoaded) {
            <ion-skeleton-text [animated]="true" class="skeleton-image"></ion-skeleton-text>
          }
          <ion-img [src]="image" class="img" [class.loaded]="imageLoaded" (ionImgDidLoad)="onImageLoad()" (ionError)="onImageError()"></ion-img>
        </div>
        @if (isFavourite) {
          <div class="favorite-tag tag-corner tag-corner-tl tag-favorite"> <ion-icon name="heart" class="heart-icon"></ion-icon></div>
        }
        @if (mediaStatus) {
          <div class="status-tag tag-corner tag-corner-bl" [attr.data-status]="mediaStatus">
            <ion-icon [name]="getStatusIcon(mediaStatus)"></ion-icon>
          </div>
        }

        <!-- FAB for quick add - shown on hover -->
        @if (authService.isAuthenticated() && mediaId && isHovered) {
          <div class="catalog-fab-container" [class.fab-open]="isFabOpen">
            <!-- Quick Actions Buttons (shown when expanded - at top) -->
            <div class="quick-actions-list" [class.visible]="isFabOpen">
              <ion-button
                class="quick-action-btn"
                shape="round"
                [attr.data-status]="'PLANNING'"
                (click)="onQuickAction($event, 'planning')">
                <ion-icon slot="icon-only" name="time"></ion-icon>
              </ion-button>

              <ion-button
                class="quick-action-btn"
                shape="round"
                [attr.data-status]="'COMPLETED'"
                (click)="onQuickAction($event, 'completed')">
                <ion-icon slot="icon-only" name="checkmark-circle"></ion-icon>
              </ion-button>

              <ion-button
                class="quick-action-btn"
                shape="round"
                [attr.data-status]="'CURRENT'"
                (click)="onQuickAction($event, 'watching')">
                <ion-icon slot="icon-only" name="play"></ion-icon>
              </ion-button>
            </div>

            <!-- Main FAB Container -->
            <div class="main-fab-wrapper">
              <!-- Main Action Button (Add to List) -->
              <ion-button
                class="main-fab-button"
                shape="round"
                color="primary"
                (click)="onFabClick($event)">
                <ion-icon slot="icon-only" [name]="getMainButtonIcon()"></ion-icon>
              </ion-button>

              <!-- Quick Actions Toggle Button (Arrow) -->
              <ion-button
                class="toggle-fab-button"
                shape="round"
                color="primary"
                (click)="onToggleClick($event)">
                <ion-icon
                  slot="icon-only"
                  [name]="getChevronIcon()">
                </ion-icon>
              </ion-button>
            </div>
          </div>
        }
      </ion-col>
    </ion-row>
    <ion-row class="label-container">
      <ion-col>
        <ion-text class="label">{{ title }}</ion-text>
      </ion-col>
    </ion-row>
    @if (rating) {
      <ion-row class="rating bottom-row">
        <ion-col>
          <ion-icon [name]="recommendation ? 'thumbs-up-sharp' : 'star'" mode="icon-only" class="rating-icon"></ion-icon>
          <ion-text>{{ rating + (recommendation ? '' : '%')}}</ion-text>
        </ion-col>
      </ion-row>
    } @else if (note) {
      <ion-row class="note">
        <ion-col>
          <ion-note>{{ note }}</ion-note>
        </ion-col>
      </ion-row>
    }
    @if (isAdult) {
      <ion-row class="adult-badge-row">
        <ion-col>
          <am-badge-adult />
        </ion-col>
      </ion-row>
    }
  }
</ion-grid>

<!-- Media List Modal -->
<am-media-list-modal
  [isOpen]="showListUpdateModal"
  [mediaInfo]="getMediaInfo()"
  [currentEntry]="mediaListEntry"
  (closed)="closeDetailedMenu()"
  (entrySaved)="onEntrySaved($event)"
/>
